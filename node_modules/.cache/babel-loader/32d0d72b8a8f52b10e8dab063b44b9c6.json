{"ast":null,"code":"import { Decimal } from \"@liquity/lib-base\";\n\nconst uniswapQuery = lqtyTokenAddress => `{\n  token(id: \"${lqtyTokenAddress.toLowerCase()}\") {\n    derivedETH\n  },\n  bundle(id: 1) {\n    ethPrice\n  },\n}`;\n\nexport async function fetchLqtyPrice(lqtyTokenAddress) {\n  var _data$token, _data$bundle;\n\n  const response = await window.fetch(\"https://api.thegraph.com/subgraphs/name/uniswap/uniswap-v2\", {\n    method: \"POST\",\n    headers: {\n      \"content-type\": \"application/json\"\n    },\n    body: JSON.stringify({\n      query: uniswapQuery(lqtyTokenAddress),\n      variables: null\n    })\n  });\n\n  if (!response.ok) {\n    return Promise.reject(\"Network error connecting to Uniswap subgraph\");\n  }\n\n  const {\n    data,\n    errors\n  } = await response.json();\n\n  if (errors) {\n    return Promise.reject(errors);\n  }\n\n  if (typeof (data === null || data === void 0 ? void 0 : (_data$token = data.token) === null || _data$token === void 0 ? void 0 : _data$token.derivedETH) === \"string\" && typeof (data === null || data === void 0 ? void 0 : (_data$bundle = data.bundle) === null || _data$bundle === void 0 ? void 0 : _data$bundle.ethPrice) === \"string\") {\n    const ethPriceUSD = Decimal.from(data.bundle.ethPrice);\n    const lqtyPriceUSD = Decimal.from(data.token.derivedETH).mul(ethPriceUSD);\n    return {\n      lqtyPriceUSD\n    };\n  }\n\n  return Promise.reject(\"Uniswap doesn't have the required data to calculate yield\");\n}","map":{"version":3,"sources":["/Users/diegoponciano/Desktop/ryan/liquity/frontend/packages/dev-frontend/src/components/Stability/context/fetchLqtyPrice.ts"],"names":["Decimal","uniswapQuery","lqtyTokenAddress","toLowerCase","fetchLqtyPrice","response","window","fetch","method","headers","body","JSON","stringify","query","variables","ok","Promise","reject","data","errors","json","token","derivedETH","bundle","ethPrice","ethPriceUSD","from","lqtyPriceUSD","mul"],"mappings":"AAAA,SAASA,OAAT,QAAwB,mBAAxB;;AAcA,MAAMC,YAAY,GAAIC,gBAAD,IAA+B;AACpD,eAAeA,gBAAgB,CAACC,WAAjB,EAA+B;AAC9C;AACA;AACA;AACA;AACA;AACA,EAPA;;AASA,OAAO,eAAeC,cAAf,CAA8BF,gBAA9B,EAAwD;AAAA;;AAC7D,QAAMG,QAAQ,GAAG,MAAMC,MAAM,CAACC,KAAP,CAAa,4DAAb,EAA2E;AAChGC,IAAAA,MAAM,EAAE,MADwF;AAEhGC,IAAAA,OAAO,EAAE;AACP,sBAAgB;AADT,KAFuF;AAKhGC,IAAAA,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAe;AACnBC,MAAAA,KAAK,EAAEZ,YAAY,CAACC,gBAAD,CADA;AAEnBY,MAAAA,SAAS,EAAE;AAFQ,KAAf;AAL0F,GAA3E,CAAvB;;AAUA,MAAI,CAACT,QAAQ,CAACU,EAAd,EAAkB;AAChB,WAAOC,OAAO,CAACC,MAAR,CAAe,8CAAf,CAAP;AACD;;AAED,QAAM;AAAEC,IAAAA,IAAF;AAAQC,IAAAA;AAAR,MAAoC,MAAMd,QAAQ,CAACe,IAAT,EAAhD;;AAEA,MAAID,MAAJ,EAAY;AACV,WAAOH,OAAO,CAACC,MAAR,CAAeE,MAAf,CAAP;AACD;;AAED,MAAI,QAAOD,IAAP,aAAOA,IAAP,sCAAOA,IAAI,CAAEG,KAAb,gDAAO,YAAaC,UAApB,MAAmC,QAAnC,IAA+C,QAAOJ,IAAP,aAAOA,IAAP,uCAAOA,IAAI,CAAEK,MAAb,iDAAO,aAAcC,QAArB,MAAkC,QAArF,EAA+F;AAC7F,UAAMC,WAAW,GAAGzB,OAAO,CAAC0B,IAAR,CAAaR,IAAI,CAACK,MAAL,CAAYC,QAAzB,CAApB;AACA,UAAMG,YAAY,GAAG3B,OAAO,CAAC0B,IAAR,CAAaR,IAAI,CAACG,KAAL,CAAWC,UAAxB,EAAoCM,GAApC,CAAwCH,WAAxC,CAArB;AAEA,WAAO;AAAEE,MAAAA;AAAF,KAAP;AACD;;AAED,SAAOX,OAAO,CAACC,MAAR,CAAe,2DAAf,CAAP;AACD","sourcesContent":["import { Decimal } from \"@liquity/lib-base\";\n\ntype UniswapResponse = {\n  data?: {\n    bundle: {\n      ethPrice: string;\n    } | null;\n    token: {\n      derivedETH: string;\n    } | null;\n  };\n  errors?: Array<{ message: string }>;\n};\n\nconst uniswapQuery = (lqtyTokenAddress: string) => `{\n  token(id: \"${lqtyTokenAddress.toLowerCase()}\") {\n    derivedETH\n  },\n  bundle(id: 1) {\n    ethPrice\n  },\n}`;\n\nexport async function fetchLqtyPrice(lqtyTokenAddress: string) {\n  const response = await window.fetch(\"https://api.thegraph.com/subgraphs/name/uniswap/uniswap-v2\", {\n    method: \"POST\",\n    headers: {\n      \"content-type\": \"application/json\"\n    },\n    body: JSON.stringify({\n      query: uniswapQuery(lqtyTokenAddress),\n      variables: null\n    })\n  });\n  if (!response.ok) {\n    return Promise.reject(\"Network error connecting to Uniswap subgraph\");\n  }\n\n  const { data, errors }: UniswapResponse = await response.json();\n\n  if (errors) {\n    return Promise.reject(errors);\n  }\n\n  if (typeof data?.token?.derivedETH === \"string\" && typeof data?.bundle?.ethPrice === \"string\") {\n    const ethPriceUSD = Decimal.from(data.bundle.ethPrice);\n    const lqtyPriceUSD = Decimal.from(data.token.derivedETH).mul(ethPriceUSD);\n\n    return { lqtyPriceUSD };\n  }\n\n  return Promise.reject(\"Uniswap doesn't have the required data to calculate yield\");\n}\n"]},"metadata":{},"sourceType":"module"}