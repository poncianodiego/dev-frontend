{"ast":null,"code":"import _slicedToArray from\"/Users/diegoponciano/Desktop/ryan/liquity/frontend/packages/dev-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useCallback,useEffect,useRef}from\"react\";import{useLiquitySelector}from\"@liquity/lib-react\";import{StabilityViewContext}from\"./StabilityViewContext\";import{jsx as _jsx}from\"react/jsx-runtime\";var transitions={NONE:{DEPOSIT_PRESSED:\"DEPOSITING\"},DEPOSITING:{CANCEL_PRESSED:\"NONE\",DEPOSIT_CONFIRMED:\"ACTIVE\"},ACTIVE:{REWARDS_CLAIMED:\"ACTIVE\",ADJUST_DEPOSIT_PRESSED:\"ADJUSTING\",DEPOSIT_EMPTIED:\"NONE\"},ADJUSTING:{CANCEL_PRESSED:\"ACTIVE\",DEPOSIT_CONFIRMED:\"ACTIVE\",DEPOSIT_EMPTIED:\"NONE\"}};var transition=function transition(view,event){var _transitions$view$eve;var nextView=(_transitions$view$eve=transitions[view][event])!==null&&_transitions$view$eve!==void 0?_transitions$view$eve:view;return nextView;};var getInitialView=function getInitialView(stabilityDeposit){return stabilityDeposit.isEmpty?\"NONE\":\"ACTIVE\";};var select=function select(_ref){var stabilityDeposit=_ref.stabilityDeposit;return stabilityDeposit;};export var StabilityViewProvider=function StabilityViewProvider(props){var children=props.children;var stabilityDeposit=useLiquitySelector(select);var _useState=useState(getInitialView(stabilityDeposit)),_useState2=_slicedToArray(_useState,2),view=_useState2[0],setView=_useState2[1];var viewRef=useRef(view);var dispatchEvent=useCallback(function(event){var nextView=transition(viewRef.current,event);console.log(\"dispatchEvent() [current-view, event, next-view]\",viewRef.current,event,nextView);setView(nextView);},[]);useEffect(function(){viewRef.current=view;},[view]);useEffect(function(){if(stabilityDeposit.isEmpty){dispatchEvent(\"DEPOSIT_EMPTIED\");}},[stabilityDeposit.isEmpty,dispatchEvent]);var provider={view:view,dispatchEvent:dispatchEvent};return/*#__PURE__*/_jsx(StabilityViewContext.Provider,{value:provider,children:children});};","map":{"version":3,"sources":["/Users/diegoponciano/Desktop/ryan/liquity/frontend/packages/dev-frontend/src/components/Stability/context/StabilityViewProvider.tsx"],"names":["React","useState","useCallback","useEffect","useRef","useLiquitySelector","StabilityViewContext","transitions","NONE","DEPOSIT_PRESSED","DEPOSITING","CANCEL_PRESSED","DEPOSIT_CONFIRMED","ACTIVE","REWARDS_CLAIMED","ADJUST_DEPOSIT_PRESSED","DEPOSIT_EMPTIED","ADJUSTING","transition","view","event","nextView","getInitialView","stabilityDeposit","isEmpty","select","StabilityViewProvider","props","children","setView","viewRef","dispatchEvent","current","console","log","provider"],"mappings":"+LAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,WAA1B,CAAuCC,SAAvC,CAAkDC,MAAlD,KAAgE,OAAhE,CACA,OAASC,kBAAT,KAAmC,oBAAnC,CAEA,OAASC,oBAAT,KAAqC,wBAArC,C,2CAQA,GAAMC,CAAAA,WAAsC,CAAG,CAC7CC,IAAI,CAAE,CACJC,eAAe,CAAE,YADb,CADuC,CAI7CC,UAAU,CAAE,CACVC,cAAc,CAAE,MADN,CAEVC,iBAAiB,CAAE,QAFT,CAJiC,CAQ7CC,MAAM,CAAE,CACNC,eAAe,CAAE,QADX,CAENC,sBAAsB,CAAE,WAFlB,CAGNC,eAAe,CAAE,MAHX,CARqC,CAa7CC,SAAS,CAAE,CACTN,cAAc,CAAE,QADP,CAETC,iBAAiB,CAAE,QAFV,CAGTI,eAAe,CAAE,MAHR,CAbkC,CAA/C,CAoBA,GAAME,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,CAACC,IAAD,CAAsBC,KAAtB,CAA+D,2BAChF,GAAMC,CAAAA,QAAQ,wBAAGd,WAAW,CAACY,IAAD,CAAX,CAAkBC,KAAlB,CAAH,+DAA+BD,IAA7C,CACA,MAAOE,CAAAA,QAAP,CACD,CAHD,CAKA,GAAMC,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,CAACC,gBAAD,CAAuD,CAC5E,MAAOA,CAAAA,gBAAgB,CAACC,OAAjB,CAA2B,MAA3B,CAAoC,QAA3C,CACD,CAFD,CAIA,GAAMC,CAAAA,MAAM,CAAG,QAATA,CAAAA,MAAS,UAAGF,CAAAA,gBAAH,MAAGA,gBAAH,OAA+DA,CAAAA,gBAA/D,EAAf,CAEA,MAAO,IAAMG,CAAAA,qBAA+B,CAAG,QAAlCA,CAAAA,qBAAkC,CAAAC,KAAK,CAAI,IAC9CC,CAAAA,QAD8C,CACjCD,KADiC,CAC9CC,QAD8C,CAEtD,GAAML,CAAAA,gBAAgB,CAAGlB,kBAAkB,CAACoB,MAAD,CAA3C,CAFsD,cAI9BxB,QAAQ,CAAgBqB,cAAc,CAACC,gBAAD,CAA9B,CAJsB,wCAI/CJ,IAJ+C,eAIzCU,OAJyC,eAKtD,GAAMC,CAAAA,OAAO,CAAG1B,MAAM,CAAgBe,IAAhB,CAAtB,CAEA,GAAMY,CAAAA,aAAa,CAAG7B,WAAW,CAAC,SAACkB,KAAD,CAA2B,CAC3D,GAAMC,CAAAA,QAAQ,CAAGH,UAAU,CAACY,OAAO,CAACE,OAAT,CAAkBZ,KAAlB,CAA3B,CAEAa,OAAO,CAACC,GAAR,CACE,kDADF,CAEEJ,OAAO,CAACE,OAFV,CAGEZ,KAHF,CAIEC,QAJF,EAMAQ,OAAO,CAACR,QAAD,CAAP,CACD,CAVgC,CAU9B,EAV8B,CAAjC,CAYAlB,SAAS,CAAC,UAAM,CACd2B,OAAO,CAACE,OAAR,CAAkBb,IAAlB,CACD,CAFQ,CAEN,CAACA,IAAD,CAFM,CAAT,CAIAhB,SAAS,CAAC,UAAM,CACd,GAAIoB,gBAAgB,CAACC,OAArB,CAA8B,CAC5BO,aAAa,CAAC,iBAAD,CAAb,CACD,CACF,CAJQ,CAIN,CAACR,gBAAgB,CAACC,OAAlB,CAA2BO,aAA3B,CAJM,CAAT,CAMA,GAAMI,CAAAA,QAAQ,CAAG,CACfhB,IAAI,CAAJA,IADe,CAEfY,aAAa,CAAbA,aAFe,CAAjB,CAKA,mBAAO,KAAC,oBAAD,CAAsB,QAAtB,EAA+B,KAAK,CAAEI,QAAtC,UAAiDP,QAAjD,EAAP,CACD,CAnCM","sourcesContent":["import React, { useState, useCallback, useEffect, useRef } from \"react\";\nimport { useLiquitySelector } from \"@liquity/lib-react\";\nimport { LiquityStoreState, StabilityDeposit } from \"@liquity/lib-base\";\nimport { StabilityViewContext } from \"./StabilityViewContext\";\nimport type { StabilityView, StabilityEvent } from \"./types\";\n\ntype StabilityEventTransitions = Record<\n  StabilityView,\n  Partial<Record<StabilityEvent, StabilityView>>\n>;\n\nconst transitions: StabilityEventTransitions = {\n  NONE: {\n    DEPOSIT_PRESSED: \"DEPOSITING\"\n  },\n  DEPOSITING: {\n    CANCEL_PRESSED: \"NONE\",\n    DEPOSIT_CONFIRMED: \"ACTIVE\"\n  },\n  ACTIVE: {\n    REWARDS_CLAIMED: \"ACTIVE\",\n    ADJUST_DEPOSIT_PRESSED: \"ADJUSTING\",\n    DEPOSIT_EMPTIED: \"NONE\"\n  },\n  ADJUSTING: {\n    CANCEL_PRESSED: \"ACTIVE\",\n    DEPOSIT_CONFIRMED: \"ACTIVE\",\n    DEPOSIT_EMPTIED: \"NONE\"\n  }\n};\n\nconst transition = (view: StabilityView, event: StabilityEvent): StabilityView => {\n  const nextView = transitions[view][event] ?? view;\n  return nextView;\n};\n\nconst getInitialView = (stabilityDeposit: StabilityDeposit): StabilityView => {\n  return stabilityDeposit.isEmpty ? \"NONE\" : \"ACTIVE\";\n};\n\nconst select = ({ stabilityDeposit }: LiquityStoreState): StabilityDeposit => stabilityDeposit;\n\nexport const StabilityViewProvider: React.FC = props => {\n  const { children } = props;\n  const stabilityDeposit = useLiquitySelector(select);\n\n  const [view, setView] = useState<StabilityView>(getInitialView(stabilityDeposit));\n  const viewRef = useRef<StabilityView>(view);\n\n  const dispatchEvent = useCallback((event: StabilityEvent) => {\n    const nextView = transition(viewRef.current, event);\n\n    console.log(\n      \"dispatchEvent() [current-view, event, next-view]\",\n      viewRef.current,\n      event,\n      nextView\n    );\n    setView(nextView);\n  }, []);\n\n  useEffect(() => {\n    viewRef.current = view;\n  }, [view]);\n\n  useEffect(() => {\n    if (stabilityDeposit.isEmpty) {\n      dispatchEvent(\"DEPOSIT_EMPTIED\");\n    }\n  }, [stabilityDeposit.isEmpty, dispatchEvent]);\n\n  const provider = {\n    view,\n    dispatchEvent\n  };\n\n  return <StabilityViewContext.Provider value={provider}>{children}</StabilityViewContext.Provider>;\n};\n"]},"metadata":{},"sourceType":"module"}